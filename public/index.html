<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Vagas de Estágio em Desenvolvimento de Software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    :root{
      --bg:#0b1020; --panel:#111827; --text:#e5e7eb; --muted:#94a3b8;
      --border:#1f2937; --chip:#334155; --accent:#22c55e; --accent2:#60a5fa; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    header{ text-align:center; padding:24px 16px 10px; }
    header h1{ margin:0 0 6px; font-size:1.6rem; }
    header p{ margin:0; color:var(--muted); }
    .container{ max-width:980px; margin:18px auto; padding:0 16px; }
    .panel{ background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:16px; }
    label{ display:block; font-size:.9rem; color:var(--muted); margin-bottom:6px; }
    input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:#0b1220; color:var(--text); outline:none; }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    button{ appearance:none; border:none; border-radius:10px; padding:10px 14px; font-weight:600; cursor:pointer; }
    button.primary{ background:var(--accent); color:#0b1020; }
    button.secondary{ background:var(--accent2); color:#0b1020; }
    button:disabled{ opacity:.6; cursor:not-allowed; }
    .hint{ margin-top:8px; color:var(--muted); font-size:.9rem; }
    .error{ color:#fecaca; margin-top:8px; }
    .results{ margin-top:16px; display:grid; gap:12px; }
    .card{ background:#0b1220; border:1px solid var(--border); border-radius:12px; padding:12px; }
    .card h3{ margin:0 0 6px; font-size:1.05rem; }
    .card p{ margin:0; color:#cbd5e1; }
    .tags{ display:flex; gap:6px; flex-wrap:wrap; margin-top:8px; }
    .tag{ font-size:.8rem; border:1px solid var(--chip); border-radius:999px; padding:4px 8px; color:#cbd5e1; }
    .linkbtn{ margin-top:10px; background:var(--accent); color:#0b1020; padding:8px 10px; border-radius:8px; text-decoration:none; display:inline-block; }
    .summary{ margin-top:18px; background:#0b1220; border:1px dashed var(--chip); border-radius:12px; padding:12px; white-space:pre-wrap; }
    footer{ text-align:center; color:var(--muted); padding:26px 16px; font-size:.9rem; }
  </style>
</head>
<body>
  <header>
    <h1>Vagas de Estágio em Desenvolvimento de Software</h1>
    <p>Busque por termos específicos e refine com o Gemini para insights úteis.</p>
  </header>

  <main class="container">
    <section class="panel">
      <label for="keywords">Palavras‑chave</label>
      <input id="keywords" placeholder="ex.: estágio React Porto Alegre, estágio Java Curitiba"/>
      <div class="actions">
        <button id="searchBtn" class="primary">Buscar</button>
        <button id="refineBtn" class="secondary" disabled>Refinar com Gemini</button>
      </div>
      <div class="hint">Dica: inclua “estágio” + tecnologia + cidade (ex.: “estágio Java Porto Alegre”).</div>
      <div id="error" class="error" hidden></div>

      <div id="results" class="results"></div>
      <div id="summary" class="summary" hidden></div>
    </section>
  </main>

  <footer>
    Resultados obtidos via busca proxy (DuckDuckGo/Google CSE) e refino com Gemini. Use termos específicos para melhores links.
  </footer>

  <script>
    let currentResults = [];

    async function doSearch(){
      const q = document.getElementById("keywords").value.trim() || "vagas estágio desenvolvimento software região sul Brasil";
      const errorEl = document.getElementById("error");
      const resultsEl = document.getElementById("results");
      const summaryEl = document.getElementById("summary");

      errorEl.hidden = true;
      resultsEl.innerHTML = "";
      summaryEl.hidden = true;
      document.getElementById("refineBtn").disabled = true;

      try {
        const resp = await fetch(`/search?q=${encodeURIComponent(q)}`);
        const data = await resp.json();
        currentResults = (data.results || []);

        if (!currentResults.length) {
          errorEl.textContent = "Nenhum resultado relevante. Especifique melhor (ex.: 'estágio React Curitiba').";
          errorEl.hidden = false;
          return;
        }

        for (const r of currentResults) {
          const card = document.createElement("div");
          card.className = "card";

          const title = document.createElement("h3");
          title.textContent = r.title;

          const desc = document.createElement("p");
          desc.textContent = r.description || "—";

          const tags = document.createElement("div");
          tags.className = "tags";
          (r.tags?.techs || []).forEach(t => {
            const el = document.createElement("span");
            el.className = "tag";
            el.textContent = t;
            tags.appendChild(el);
          });
          (r.tags?.cities || []).forEach(c => {
            const el = document.createElement("span");
            el.className = "tag";
            el.textContent = c;
            tags.appendChild(el);
          });

          const link = document.createElement("a");
          link.className = "linkbtn";
          link.href = r.url;
          link.target = "_blank";
          link.rel = "noopener noreferrer";
          link.textContent = "Abrir vaga";

          card.appendChild(title);
          card.appendChild(desc);
          card.appendChild(tags);
          card.appendChild(link);
          resultsEl.appendChild(card);
        }

        document.getElementById("refineBtn").disabled = false;
      } catch (e) {
        console.error(e);
        errorEl.textContent = "Falha ao buscar. Ajuste os termos e tente novamente.";
        errorEl.hidden = false;
      }
    }

    async function doRefine(){
      const summaryEl = document.getElementById("summary");
      summaryEl.hidden = false;
      summaryEl.textContent = "Processando com Gemini...";

      try {
        const resp = await fetch("/refine", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ results: currentResults })
        });
        const data = await resp.json();
        summaryEl.textContent = data.resumo || "Não foi possível gerar resumo.";
      } catch (e) {
        console.error(e);
        summaryEl.textContent = "Erro ao refinar com Gemini.";
      }
    }

    document.getElementById("searchBtn").addEventListener("click", doSearch);
    document.getElementById("refineBtn").addEventListener("click", doRefine);
    document.getElementById("keywords").addEventListener("keydown", e => {
      if (e.key === "Enter") doSearch();
    });
  </script>
</body>
</html>
